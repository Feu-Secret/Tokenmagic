{
  "_id": "iQbTZfjc0y3vHYTB",
  "name": "00 - C - TMFX GUI - Book of Fire Sample",
  "type": "script",
  "author": "f8mJy0XxrFT8Pzt3",
  "img": "icons/svg/dice-target.svg",
  "scope": "global",
  "command": "// Big thanks to Bruno Calado: the Mestre Digital!\n\n// You can create your own compendium, and put any effects in it\n// Just change MyCompendium below with your custom compendium\n\nconst MyCompendium = 'TokenMagic Book of Fire';\n\n\n// ------------------------\nconst macroVersion = 'v0.2.1';\n\n/* Simple GUI - Token Magic\nAuthor : brunocalado\nFeatures\n- Detect token selected/targeted\n- Realtime preview\nSource: \nIcon: \n*/\n\nlet filterType;\n(async () => {\n    let msgtoken = ``;\n    if (canvas.tokens.controlled != 0 || canvas.background.controlled[0]) {\n        filterType = 'selected';\n    } else if (game.user.targets.size != 0) {\n        filterType = 'targeted';\n    } else {\n        ui.notifications.error(\"Select something!\");\n        return;\n    }\n\n    let template =\n        `<style>\n  #tokenmagic-quickpreview header {\n    background: #9c0972;\n    border-radius: 0;    \n    border: none;    \n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n  #tokenmagic-quickpreview form {\n    margin-bottom: 30px;   \n  }\n  #tokenmagic-quickpreview .window-content {    \n    height: 600px;    \n  }  \n  #tokenmagic-quickpreview .form-fields.buttons {\n    justify-content: flex-start !important;\n  }\n  #tokenmagic-quickpreview .button {\n    height: 35px;\n    box-shadow: inset 0 0 0 1px #1111FF,inset 0 0 0 1.5px var(--tertiary),inset 0 0 0 1px #1111FF;\n    font-size: 12px;\n    padding: 0;\n    background: #eb34b7;\n    color: white;\n    cursor: pointer;\n  }\n  #tokenmagic-quickpreview .button:hover {\n    box-shadow: 0 0 4px red;\n  }\n  #tokenmagic-quickpreview .meuitem input[type=\"radio\"] {\n    opacity: 0;\n    position: fixed;\n    width: 0;  \n  }\n  #tokenmagic-quickpreview .minhalista {    \n    display: inline-block;\n    list-style-type: none; \n    text-align: left; \n    margin: 0; \n    padding: 0; \n    width: 100%;\n  }\n  #tokenmagic-quickpreview .meuitem {    \n    display: inline-block;    \n    padding: 2px; \n  }  \n  #tokenmagic-quickpreview .meuitem label {    \n    cursor: pointer;    \n    margin: 0px 3px ;\n    \n    height: 100%;\n    width: 100%;\n    border-radius: 3px;\n    font-size: 16px;\n    font-family: \"Signika\", sans-serif;  \n    background: #9c0972;        \n    color: white;    \n  }\n  \n  #tokenmagic-quickpreview .radios label i {\n    margin-right: 5px;\n    color: white;\n    background: #eb34b7;\n  }\n  #tokenmagic-quickpreview .meuitem label:hover {\n    box-shadow: 0 0 14px black;\n  }\n  #tokenmagic-quickpreview .meuitem input[type=\"radio\"]:checked + label {\n    background: rgba(0, 0, 150, 0.7);\n  }\n  #tokenmagic-quickpreview .dialog-button {\n    height: 50px;\n    background: #9c0972;\n    color: white;\n    justify-content: space-evenly;\n    align-items: center;\n    cursor: pointer;\n  }\n\n  </style>\n    \n  <div class=\"form-fields\">\n  <ul class=\"minhalista\">\n    ${await loadMacroButton()}\n  </ul>\n  \n  </div>\n  \n  \n\n  <!------ Javascript ------->   \n  <script>  \n    ${await removeAll()}\n    ${await loadMacros(filterType)}\n  </script>`;\n\n    new Dialog({\n        title: `TMFX GUI - ${macroVersion}`,\n        content: template,\n        buttons: {\n            yes: {\n                icon: \"<i class='fas fa-check'></i>\",\n                label: \"Apply\",\n                callback: () => {}\n            },\n            clear: {\n                icon: \"<i class='fas fa-skull'></i>\",\n                label: \"Clear\",\n                callback: async (html) => {\n                    removeOnSelected(html);\n                }\n            }\n        },\n        default: \"yes\",\n        close: html => {\n        }\n    }, { id: 'tokenmagic-quickpreview' }).render(true);\n    //} ).render(true);  \n})()\n\n// ==============================\n// Main\n// ==============================\n\n\n// ==============================\n// Common Functions \n// ==============================\nasync function removeOnSelected() {\n    await TokenMagic.deleteFilters(_token);\n    await TokenMagic.deleteFiltersOnSelected(); // Delete all filters on the selected tokens/tiles\n}\n\nasync function loadMacroButton() {\n    const list_compendium = await game.packs.filter(p => p.metadata.type == 'Macro');\n    const inside = await list_compendium.filter(p => p.metadata.label == MyCompendium)[0].index.contents;\n    let msg = ``;\n    let tmp;\n    let counter = 1;\n\n    inside.map((el) => {\n        tmp = el.name.split(' ').join('');\n        msg += `<li class=\"meuitem\"><input type=\"radio\" name=\"Type\" id=\"${tmp.toLowerCase()}\" value=\"${tmp}\"><label for=\"${tmp.toLowerCase()}\" onclick=\"effect${counter}(1)\">${tmp}</label></li>`;\n        counter += 1;\n    });\n\n    return msg;\n}\n\nasync function loadMacros(filterType) {\n    const pack = await game.packs.find(p => p.metadata.label == MyCompendium);\n    const index = await pack.getIndex({fields: [\"name\", \"img\", \"command\"]});\n    const inside = index.contents;\n    let msg = ``;\n    let tmp;\n    let counter = 1;\n\n    inside.map((el) => {\n        let macro = el.command;\n        if (filterType == 'selected') {\n            macro = macro.replace(\"OnTargeted\", \"OnSelected\");\n        } else {\n            macro = macro.replace(\"OnSelected\", \"OnTargeted\");\n        }\n        tmp = el.name.split(' ').join('');\n        msg += `async function effect${counter}() {`;\n        msg += `await removeOnSelected();`;\n        msg += `${macro}`;\n        msg += `}`;\n        counter += 1;\n    });\n    return msg;\n}\n\nfunction removeAll() {\n    const clean = `async function removeOnSelected() {await TokenMagic.deleteFilters(_token);await TokenMagic.deleteFiltersOnSelected()}`;\n    return clean;\n}",
  "folder": null,
  "sort": 9000000,
  "flags": {},
  "ownership": {
    "default": 0
  },
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "2.3.1",
    "coreVersion": "11.308",
    "createdTime": null,
    "modifiedTime": 1695296911423,
    "lastModifiedBy": "packsbuilder0000"
  },
  "_key": "!macros!iQbTZfjc0y3vHYTB"
}
